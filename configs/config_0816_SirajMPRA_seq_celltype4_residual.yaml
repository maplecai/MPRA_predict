train: True # 是训练还是测试
distribute: False # 是否使用分布式训练
gpu_ids: [2] # 训练使用的gpu id
seed: 0 # 随机数种子
save_dir: saved # 保存的根路径
num_epochs: 500 # 训练的epoch总数
num_log_steps: 10 # 每多少个step输出log, 0 means no output
num_valid_epochs: 1 # 每多少个epoch运行valid
scheduler_interval: step
global_batch_size: &global_batch_size 4096
load_saved_model: false

cell_types: &cell_types ['HepG2', 'K562', 'A549', 'HCT116']

train_dataset:
    type: &type SeqLabelDataset
    args: &args
        data_path: '/home/hxcai/cell_type_specific_CRE/data/SirajMPRA/SirajMPRA_total.csv'
        seq_column: 'seq'
        label_column: *cell_types
        apply_filter: true
        filter_column: 'chr'
        filter_in_list: ['chr3', 'chr4', 'chr5', 'chr6', 'chr7', 'chr8', 'chr9', 'chr10', 'chr11', 'chr12', 'chr13', 'chr14', 'chr15', 'chr16', 'chr17', 'chr18', 'chr19', 'chr20', 'chr21', 'chr22']

valid_dataset:
    type: *type
    args:
        <<: *args
        filter_in_list: ['chr1']

test_dataset:
    type: *type
    args:
        <<: *args
        apply_filter: false

model:
    type: MyBassetResidual
    args:
        input_length:       200
        output_dim:         4
        residual:           False
        sigmoid:            False
        squeeze:            True
        
        conv_num:           16
        conv_channels:      256
        conv_kernel_size:   3
        conv_stride:        1
        conv_padding:       1
        conv_dropout_rate:  0.2

        pool_interval:      4
        pool_kernel_size:   2
        pool_padding:       0
        
        linear_num:         2
        linear_channels:    768
        linear_dropout_rate: 0.5


data_loader:
    type: DataLoader
    args:
        batch_size: *global_batch_size
        num_workers: 1

optimizer:
    type: Adam
    args:
        lr: 1.0e-3
        weight_decay: 1.0e-4

lr_scheduler:
    type: CosineAnnealingWarmRestarts
    args: 
        T_0: 20

# loss_func:
#     type: MyBCELoss

# metric_func_list:
# -   type: MyBCELoss
# -   type: Accuracy
# -   type: AUROC
# -   type: AUPRC

loss_func:
    type: MyMSELoss

metric_func_list:
-   type: MyMSELoss
-   type: Pearson
-   type: Spearman

early_stopper:
    type: EarlyStopping
    args:
        monitor: 'Pearson'
        patience: 30
        delta: 0
        mode: 'max'
        verbose: true

logger:
    version: 1
    disable_existing_loggers: false
    formatters:
        simple:
            format: '%(message)s'
        complex:
            format: '%(asctime)s - %(levelname)s - %(message)s'
    handlers:
        console_handler:
            class: logging.StreamHandler
            level: INFO
            formatter: complex
            stream: ext://sys.stdout
        info_file_handler:
            class: logging.handlers.RotatingFileHandler
            level: INFO
            formatter: complex
            filename: info.log
            maxBytes: 10485760
            backupCount: 10
            encoding: utf8
        debug_file_handler:
            class: logging.handlers.RotatingFileHandler
            level: DEBUG
            formatter: complex
            filename: debug.log
            maxBytes: 10485760
            backupCount: 10
            encoding: utf8
    root:
        level: DEBUG
        handlers:
            - console_handler
            - info_file_handler
            - debug_file_handler
